<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics-compat.js"></script>
  <title>SoMAp - Society Management App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* ==== SoMAp anti-overlap + responsive overrides ==== */
    *, *::before, *::after { box-sizing: border-box; }
    .app-header h1, .app-header .title,
    .section h1, .section h2, .section h3, .section p,
    .card, .card *,
    .stat-card, .stat-card *,
    .badge, .pill, .menu-group h3,
    .workspace .grid, .workspace .grid * {
      white-space: normal !important;
      overflow-wrap: anywhere;
      word-break: break-word;
    }
    .workspace, .section, .card, .stat-card, .grid, .row {
      min-width: 0;
    }
    .layout-row, .grid, .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .card, .stat-card {
      flex: 1 1 280px;
      min-width: 240px;
    }
    img, video, canvas {
      max-width: 100%;
      height: auto;
    }
    .workspace { margin-left: 64px; }
    @media (max-width: 768px) {
      .workspace { margin-left: 56px; }
    }
    @media (max-width: 560px) {
      .workspace { margin-left: 0; }
      .sidebar { position: fixed; transform: translateX(-100%); transition: transform .2s ease; }
      .has-sidebar-open .sidebar { transform: none; }
    }
    :root {
      --primary: #4f46e5;
      --secondary: #818cf8;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #06b6d4;
      --light-bg: #f9fafb;
      --border: #e5e7eb;
    }
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      overflow-x: hidden;
      background: linear-gradient(135deg, #007bff, #6610f2);
      color: #fff;
      min-height: 100vh;
    }
    .sidebar-icon {
      position: relative;
      transition: all 0.3s;
    }
    .sidebar-icon:hover {
      background-color: rgba(79, 70, 229, 0.1);
    }
    .sidebar-icon.active {
      background-color: var(--primary);
      color: white;
    }
    .sidebar-tooltip {
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      background: #1f2937;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      opacity: 0;
      pointer-events: none;
      transition: all 0.2s;
      z-index: 100;
      white-space: nowrap;
    }
    .sidebar-icon:hover .sidebar-tooltip {
      opacity: 1;
      transform: translateY(-50%) translateX(8px);
    }
    .module-panel {
      transition: transform 0.3s ease-in-out;
      transform: translateX(100%);
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
    }
    .module-panel.active {
      transform: translateX(0);
    }
    .card {
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.3s;
      background: linear-gradient(135deg, #ffffff, #e5e7eb);
      color: #000;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .stat-card {
      transition: all 0.3s;
      background: linear-gradient(135deg, #20c997, #0dcaf0);
      color: #fff;
    }
    .stat-card:hover {
      transform: translateY(-3px);
    }
    .btn {
      transition: all 0.2s;
    }
    .btn:hover {
      transform: translateY(-1px);
    }
    .btn:active {
      transform: translateY(0);
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    .loader {
      border-top-color: var(--primary);
      animation: spinner 0.6s linear infinite;
    }
    @keyframes spinner {
      to { transform: rotate(360deg); }
    }
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
    .workspace {
      flex: 1 1 auto;
      min-width: 0;
      overflow-x: hidden;
      overflow-y: auto;
      background: linear-gradient(135deg, #007bff, #6610f2);
      padding: 1rem;
      transition: margin-left 0.3s ease;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      max-width: 100%;
      word-break: break-word;
    }
    .stat-card .mt-4, .card .mt-4 {
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    @media (min-width: 1024px) {
      .grid { gap: 2rem; }
      .workspace { padding: 1.5rem; }
    }
    @media (max-width: 767px) {
      .grid { grid-template-columns: 1fr; }
      .workspace { padding: 0.5rem; }
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .badge-pulse {
      animation: pulse 2s infinite;
    }
    .sidebar-logo {
      height: 40px;
      width: auto;
      max-width: 100%;
      display: block;
      margin: 0 auto;
    }
    .sidebar-expanded .sidebar-logo {
      height: 48px;
    }
    @media (max-width: 480px) {
      .sidebar-logo { height: 32px; }
    }
    .navbar {
      background: linear-gradient(135deg, #28a745, #20c997);
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .sidebar {
      background: linear-gradient(to bottom, #fd7e14, #ffc107);
      height: 100vh;
      padding: 20px;
      position: fixed;
      width: 64px;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      transition: width 0.3s ease;
    }
    .sidebar-expanded .sidebar {
      width: 250px;
    }
    .sidebar a, .sidebar button {
      color: #fff;
      text-decoration: none;
      display: block;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 10px;
      transition: background 0.3s;
    }
    .sidebar a:hover, .sidebar button:hover {
      background-color: rgba(255,255,255,0.2);
    }
    .main-content {
      margin-left: 64px;
      padding: 20px;
      transition: margin-left 0.3s ease;
    }
    .sidebar-expanded .main-content {
      margin-left: 250px;
    }
    .welcome-note {
      background: linear-gradient(135deg, #6f42c1, #d63384);
      padding: 50px;
      text-align: center;
      border-radius: 20px;
      margin: 50px auto;
      max-width: 800px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }
    .market-section {
      background: linear-gradient(135deg, #dc3545, #fd7e14);
      padding: 30px;
      border-radius: 15px;
      color: #fff;
    }
    .market-img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .quick-action-btn {
      background: linear-gradient(135deg, #198754, #20c997);
      color: #fff;
      border: none;
      margin: 10px;
      padding: 15px 30px;
      border-radius: 10px;
      font-weight: bold;
      transition: opacity 0.3s;
    }
    .quick-action-btn:hover {
      opacity: 0.9;
    }
    #language-select {
      margin: 20px auto;
      width: 200px;
      background: #fff;
      color: #000;
      border: 2px solid #ced4da;
      border-radius: 10px;
    }
    .events-list {
      list-style: none;
      padding: 0;
    }
    .events-list li {
      background: #fff;
      color: #000;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .chart-container {
      background: #fff;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
    }
    .footer {
      background-color: #343a40;
      color: #fff;
      padding: 20px;
      text-align: center;
      margin-top: 50px;
      border-top: 2px solid #fff;
    }
    .role-specific {
      display: none;
    }
    .module-section {
      background: linear-gradient(135deg, #ffc107, #fd7e14);
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      color: #000;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600">
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <div id="sidebar" class="flex flex-col h-full bg-gradient-to-b from-orange-500 to-yellow-400 shadow-md p-1 relative z-10" style="width: 64px; transition: width 0.3s ease;">
      <div class="flex items-center justify-center h-14 mb-2">
        <img src="images/somap-logo.png.jpg" alt="SoMAp Logo" class="sidebar-logo">
      </div>
      <div class="flex-1 overflow-y-auto">
        <div class="flex flex-col space-y-1">
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto active" data-module="dashboard">
            <i class="fas fa-th-large text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-dashboard">Dashboard</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-dashboard-expanded">Dashboard</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="erp">
            <i class="fas fa-user-graduate text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-academic">Academic</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-academic-expanded">Academic</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="finance">
            <i class="fas fa-money-bill-wave text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-finance">Finance</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-finance-expanded">Finance</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="library">
            <i class="fas fa-book text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-resources">Digital Library</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-resources-expanded">Digital Library</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="communication">
            <i class="fas fa-comment-alt text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-communications">Communications</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-communications-expanded">Communications</span>
            <span class="absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center badge-pulse">5</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="marketplace">
            <i class="fas fa-store text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-market">Marketplace</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-market-expanded">Marketplace</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="sponsorship">
            <i class="fas fa-hand-holding-heart text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-sponsorship">Sponsorship</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-sponsorship-expanded">Sponsorship</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="ai">
            <i class="fas fa-robot text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-ai-insights">AI Insights</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-ai-insights-expanded">AI Insights</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="volunteer">
            <i class="fas fa-people-carry text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-volunteers">Volunteers</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-volunteers-expanded">Volunteers</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto" data-module="events">
            <i class="fas fa-calendar-alt text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-events">Events</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-events-expanded">Events</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto role-specific admin-only" data-module="admin-tools">
            <i class="fas fa-tools text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-admin-tools">Admin Tools</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-admin-tools-expanded">Admin Tools</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto role-specific teacher-only" data-module="class-tools">
            <i class="fas fa-chalkboard-teacher text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-class-tools">Class Tools</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-class-tools-expanded">Class Tools</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto role-specific accountant-only" data-module="finance-tools">
            <i class="fas fa-calculator text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-finance-tools">Finance Tools</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-finance-tools-expanded">Finance Tools</span>
          </button>
          <button class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto role-specific parent-only" data-module="child-info">
            <i class="fas fa-child text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-child-info">Child Info</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-child-info-expanded">Child Info</span>
          </button>
          <button id="logout" class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto">
            <i class="fas fa-sign-out-alt text-xl"></i>
            <span class="sidebar-tooltip" id="sidebar-logout">Logout</span>
            <span class="sidebar-expanded hidden ml-3 text-sm font-medium" id="sidebar-logout-expanded">Logout</span>
          </button>
        </div>
      </div>
      <div class="mt-2 mb-1">
        <button id="toggle-sidebar" class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto">
          <i class="fas fa-chevron-right text-sm sidebar-collapsed"></i>
          <i class="fas fa-chevron-left text-sm sidebar-expanded hidden"></i>
          <span class="sidebar-tooltip">Toggle Menu</span>
        </button>
        <div class="sidebar-icon flex items-center justify-center w-10 h-10 rounded-lg text-white mx-auto mt-1">
          <img src="https://cdn.pixabay.com/photo/2016/08/08/09/17/avatar-1577909_960_720.png" alt="Profile" class="rounded-full h-8 w-8 object-cover">
          <span class="sidebar-tooltip">Profile</span>
          <span class="sidebar-expanded hidden ml-3 text-sm font-medium">Admin</span>
        </div>
      </div>
    </div>
    <!-- Main workspace -->
    <div class="workspace flex-1 min-w-0 overflow-x-hidden overflow-y-auto bg-gradient-to-br from-blue-500 to-purple-600 transition-all">
      <header class="bg-white shadow-sm">
        <div class="flex items-center justify-between px-6 py-3">
          <div>
            <h1 id="page-title" class="text-xl font-semibold text-gray-800">SoMAp - SOCIETY MANAGEMENT APP</h1>
          </div>
          <div class="flex items-center space-x-4">
            <div class="relative">
              <input type="text" class="px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500 w-64" placeholder="Search...">
              <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
            </div>
            <button class="p-2 rounded-lg hover:bg-gray-100">
              <i class="far fa-bell text-gray-500 relative">
                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">3</span>
              </i>
            </button>
            <button class="p-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-cog text-gray-500"></i>
            </button>
          </div>
        </div>
      </header>
      <!-- Module Detail Panel -->
      <div id="module-panel" class="module-panel fixed top-0 right-0 h-full bg-white shadow-lg w-96 z-20 overflow-y-auto">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <h2 id="module-title" class="text-xl font-bold text-gray-800">Module Details</h2>
            <button id="close-module" class="text-gray-500 hover:text-gray-800">
              <i class="fas fa-times text-lg"></i>
            </button>
          </div>
          <div id="module-content" class="pb-5"></div>
        </div>
      </div>
      <!-- Module templates -->
      <div id="module-templates" class="hidden">
        <div id="library-template">
          <div class="mb-4">
            <div class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm mb-4">
              Access and manage digital educational resources for students and teachers.
            </div>
            <div class="flex border-b mb-4">
              <button class="library-tab px-4 py-2 font-medium border-b-2 border-indigo-500 text-indigo-600 active" data-tab="resources">Resources</button>
              <button class="library-tab px-4 py-2 font-medium text-gray-500 hover:text-gray-700" data-tab="upload">Upload</button>
              <button class="library-tab px-4 py-2 font-medium text-gray-500 hover:text-gray-700" data-tab="categories">Categories</button>
            </div>
            <div class="library-tab-content active" data-tab="resources">
              <div class="mb-3">
                <div class="relative">
                  <input type="text" placeholder="Search resources..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                  <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                <div class="flex flex-wrap gap-2 mt-2">
                  <span class="px-2 py-1 bg-gray-100 text-xs text-gray-700 rounded-full">All</span>
                  <span class="px-2 py-1 bg-indigo-100 text-xs text-indigo-700 rounded-full">Science</span>
                  <span class="px-2 py-1 bg-gray-100 text-xs text-gray-700 rounded-full">Mathematics</span>
                  <span class="px-2 py-1 bg-gray-100 text-xs text-gray-700 rounded-full">Languages</span>
                  <span class="px-2 py-1 bg-gray-100 text-xs text-gray-700 rounded-full">History</span>
                </div>
              </div>
      <!-- Welcome Page -->
      <div id="welcome-page" class="container section-padding">
        <div class="welcome-note">
          <h1 id="welcome-title">Welcome to SoMAp</h1>
          <p id="welcome-text">Your Educational SuperApp. Manage academics, finances, health, and marketplace with speed and simplicity. Inspired to build the Society</p>
          <select id="language-select" class="form-select form-control-custom">
            <option value="en">English</option>
            <option value="sw">Swahili</option>
          </select>
          <button id="get-started" class="btn btn-lg btn-custom">Get Started</button>
        </div>
      </div>
      <!-- Login Page -->
      <div id="login-page" class="container section-padding hidden">
        <div class="card p-4">
          <h2 class="text-center">Sign In to SoMAp</h2>
          <div class="space-y-3">
            <div>
              <label for="email" class="block text-sm text-gray-600 mb-1">Email</label>
              <input type="email" class="form-control form-control-custom w-full" id="email" required>
            </div>
            <div>
              <label for="password" class="block text-sm text-gray-600 mb-1">Password</label>
              <input type="password" class="form-control form-control-custom w-full" id="password" required>
            </div>
            <div>
              <label for="role" class="block text-sm text-gray-600 mb-1">Role</label>
              <select id="role" class="form-select form-control-custom w-full">
                <option value="parent">Parent</option>
                <option value="staff">Staff/Teacher</option>
                <option value="admin">Admin</option>
                <option value="accountant">Accountant</option>
              </select>
            </div>
            <div id="parent-phone" class="hidden">
              <label for="phone" class="block text-sm text-gray-600 mb-1">Phone Number (for Parents)</label>
              <input type="tel" class="form-control form-control-custom w-full" id="phone" placeholder="+255...">
            </div>
            <button id="login-submit" class="btn btn-success btn-lg w-full">Sign In</button>
            <hr class="my-3">
            <button id="google-signin" class="btn btn-danger btn-lg w-full mb-2">Sign In with Google</button>
            <button id="github-signin" class="btn btn-dark btn-lg w-full">Sign In with GitHub</button>
          </div>
        </div>
      </div>
      <!-- Main Dashboard -->
      <div id="main-dashboard" class="hidden">
        <div class="main-content">
          <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
              <a class="navbar-brand text-white" href="#">SoMAp Dashboard</a>
              <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                  <li class="nav-item"><a class="nav-link text-white" href="#market">SoMAp Market</a></li>
                  <li class="nav-item"><a class="nav-link text-white" href="#schools">Schools</a></li>
                </ul>
              </div>
            </div>
          </nav>
 <!-- ==== SweetAlert2 ==== -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- ==== Chart.js ==== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // ==== Firebase Config (REAL ONE) ====
  const firebaseConfig = {
    apiKey: "AIzaSyBhONntRE_aRsU0y1YcPZzWud3CBfwH_a8",
    authDomain: "somaptestt.firebaseapp.com",
    databaseURL: "https://somaptestt-default-rtdb.firebaseio.com",
    projectId: "somaptestt",
    storageBucket: "somaptestt.appspot.com",
    messagingSenderId: "105526245138",
    appId: "1:105526245138:web:b8e7c0cb82a46e861965cb",
    measurementId: "G-4HKX7KN6Q3"
  };

  // ==== Initialize Firebase ====
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const db = firebase.database();
  const storage = firebase.storage();
  const auth = firebase.auth();

  console.log("✅ Firebase initialized, DB + Storage ready");

  // ==== Language Translations ====
  const translations = {
    en: {
      welcomeTitle: "Welcome to SoMAp",
      welcomeText: "Transform your school management with our comprehensive Educational SuperApp. Streamline operations, boost academic performance, connect with parents, and manage finances effortlessly.",
      getStarted: "Get Started",
      dashboard: "Dashboard",
      academic: "Academic",
      attendance: "Attendance",
      discipline: "Discipline",
      finance: "Finance",
      resources: "Digital Library",
      communications: "Communications",
      market: "Marketplace",
      sponsorship: "Sponsorship",
      aiInsights: "AI Insights",
      volunteers: "Volunteers",
      events: "Events",
      adminTools: "Admin Tools",
      classTools: "Class Tools",
      financeTools: "Finance Tools",
      childInfo: "Child Info",
      logout: "Logout"
    },
    sw: {
      welcomeTitle: "Karibu kwa SoMAp",
      welcomeText: "SuperApp ya Elimu. Dhibiti masomo, fedha, na mawasiliano kwa urahisi. Tumehamasishwa kujenga Jamii bora.",
      getStarted: "Anza",
      dashboard: "Dashibodi",
      academic: "Elimu",
      attendance: "Mahudhurio",
      discipline: "Nidhamu",
      finance: "Fedha",
      resources: "Maktaba ya Dijitali",
      communications: "Mawasiliano",
      market: "Soko",
      sponsorship: "Ufadhili",
      aiInsights: "Maarifa ya AI",
      volunteers: "Wajitolea",
      events: "Matukio",
      adminTools: "Zana za Admin",
      classTools: "Zana za Darasa",
      financeTools: "Zana za Fedha",
      childInfo: "Taarifa za Mtoto",
      logout: "Toka"
    }
  };

  // ==== Sidebar Toggle ====
  document.getElementById('toggle-sidebar')?.addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('sidebar-expanded');
    document.querySelector('.main-content').classList.toggle('sidebar-expanded');
    document.querySelectorAll('.sidebar-collapsed').forEach(el => el.classList.toggle('hidden'));
    document.querySelectorAll('.sidebar-expanded').forEach(el => el.classList.toggle('hidden'));
  });

  // ==== Auth: Email/Password Login ====
  document.getElementById('login-submit')?.addEventListener('click', (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, password)
      .then(handleAuthSuccess)
      .catch(err => Swal.fire("Error", "Login failed: " + err.message, "error"));
  });

  // ==== Google Sign-In ====
  function signInWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then(handleAuthSuccess)
      .catch(err => Swal.fire("Error", "Google Sign-In failed: " + err.message, "error"));
  }

  // ==== GitHub Sign-In ====
  function signInWithGitHub() {
    const provider = new firebase.auth.GithubAuthProvider();
    auth.signInWithPopup(provider)
      .then(handleAuthSuccess)
      .catch(err => Swal.fire("Error", "GitHub Sign-In failed: " + err.message, "error"));
  }

  // ==== Handle Successful Auth ====
  function handleAuthSuccess(result) {
    const user = result.user || auth.currentUser;
    Swal.fire("Welcome " + user.displayName, "Signed in successfully!", "success");

    document.getElementById('login-page')?.classList.add('hidden');
    document.getElementById('main-dashboard')?.classList.remove('hidden');
    document.getElementById('sidebar').style.display = 'block';

    console.log("✅ Logged in:", user);
  }

  // ==== Sign Out ====
  function signOutUser() {
    auth.signOut().then(() => {
      Swal.fire("Signed Out", "You have been logged out.", "info");
      document.getElementById('main-dashboard')?.classList.add('hidden');
      document.getElementById('login-page')?.classList.remove('hidden');
    });
  }

    // ==== Auto-login Check ====
  auth.onAuthStateChanged(user => {
    if (user) handleAuthSuccess({ user });
  });
</script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

      
  <script>
    // Initialize Firebase
    document.addEventListener('DOMContentLoaded', () => {
      // Tab Switching
      const tabs = document.querySelectorAll('.comm-tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('border-b-2', 'border-indigo-500', 'text-indigo-600'));
          tab.classList.add('border-b-2', 'border-indigo-500', 'text-indigo-600');
          document.querySelectorAll('.comm-tab-content').forEach(content => content.classList.remove('active'));
          document.querySelector(`.comm-tab-content[data-tab="${tab.dataset.tab}"]`).classList.add('active');
        });
      });

    </script>
<!-- jsPDF for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- jsPDF autotable plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.0/jspdf.plugin.autotable.min.js"></script>
<!-- SheetJS for Excel/CSV export -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
// Initialize Firebase references
const db = firebase.database();

// Registration form logic
document.addEventListener('DOMContentLoaded', function() {
  // Attach submit event to registration form (modal)
  document.body.addEventListener('submit', async function(e) {
    if (e.target && e.target.id === 'registrationForm') {
      e.preventDefault();

      // Collect form data
      const form = e.target;
      const formData = new FormData(form);
      const student = {};
      formData.forEach((value, key) => student[key] = value);

      // Generate admission number
      student.admissionNumber = 'ADM' + Date.now();
      form.admissionNumber.value = student.admissionNumber;

      // Save to Firebase
      try {
        await db.ref('students').push(student);
        alert('Student registered successfully!');
        form.reset();
        form.admissionNumber.value = '';
        document.getElementById('registrationModal').classList.add('hidden');
        loadStudentsList(); // Refresh list
      } catch (err) {
        alert('Registration failed: ' + err.message);
      }
    }
  });
  // Load students list on page load
  loadStudentsList();
});
// Display students in a simple list under Quick Admission
function loadStudentsList() {
  // Find the admissions tab content
  const admissionsTab = document.querySelector('.erp-tab-content[data-tab="admissions"]');
  if (!admissionsTab) return;
  let list = admissionsTab.querySelector('#studentsList');
  if (!list) {
    list = document.createElement('div');
    list.id = 'studentsList';
    admissionsTab.appendChild(list);
  }
  db.ref('students').once('value').then(snap => {
    const data = snap.val() || {};
    let html = '<h4 class="font-medium mt-4 mb-2">Registered Students</h4>';
    if (Object.keys(data).length === 0) {
      html += '<div class="text-gray-500 text-sm">No students registered yet.</div>';
    } else {
      html += '<ul class="space-y-1">';
      Object.values(data).forEach(s => {
        html += `<li class="p-2 bg-gray-50 rounded mb-1">${s.firstName || ''} ${s.lastName || ''} <span class="text-xs text-gray-400">(${s.admissionNumber || ''})</span></li>`;
      });
      html += '</ul>';
    }
    list.innerHTML = html;
  });
}
// Show/hide registered students table
document.addEventListener('click', function(e) {
  // Toggle students table
  if (e.target && e.target.id === 'showStudentsBtn') {
    const panel = document.getElementById('module-panel');
    const studentsListPanel = panel.querySelector('#studentsListPanel');
    if (studentsListPanel.classList.contains('hidden')) {
      loadStudentsTable();
      studentsListPanel.classList.remove('hidden');
      e.target.textContent = 'Hide Registered Students';
    } else {
      studentsListPanel.classList.add('hidden');
      e.target.textContent = 'See Registered Students';
    }
  }
});

// Load students and show in a table
function loadStudentsTable() {
  const panel = document.getElementById('module-panel');
  const studentsListPanel = panel.querySelector('#studentsListPanel');
  db.ref('students').once('value').then(snap => {
    const data = snap.val() || {};
    let html = '<h4 class="font-medium mb-2">Registered Students</h4>';
    if (Object.keys(data).length === 0) {
      html += '<div class="text-gray-500 text-sm">No students registered yet.</div>';
    } else {
      html += `<div class="overflow-x-auto"><table class="min-w-full text-xs sm:text-sm border">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">#</th>
            <th class="p-2 border">First Name</th>
            <th class="p-2 border">Last Name</th>
            <th class="p-2 border">Class</th>
            <th class="p-2 border">Gender</th>
            <th class="p-2 border">DOB</th>
            <th class="p-2 border">Admission No.</th>
            <th class="p-2 border">Parent</th>
            <th class="p-2 border">Contact</th>
          </tr>
        </thead>
        <tbody>`;
      let i = 1;
      Object.values(data).forEach(s => {
        html += `<tr>
          <td class="p-2 border">${i++}</td>
          <td class="p-2 border">${s.firstName || ''}</td>
          <td class="p-2 border">${s.lastName || ''}</td>
          <td class="p-2 border">${s.classLevel || ''}</td>
          <td class="p-2 border">${s.gender || ''}</td>
          <td class="p-2 border">${s.dob || ''}</td>
          <td class="p-2 border">${s.admissionNumber || ''}</td>
          <td class="p-2 border">${s.primaryParentName || ''}</td>
          <td class="p-2 border">${s.primaryParentContact || ''}</td>
        </tr>`;
      });
      html += `</tbody></table></div>`;
    }
    studentsListPanel.innerHTML = html;
  });
}
</script>
<script>
  document.querySelector('[data-module="erp"]').addEventListener('click', () => {
    window.location.href = 'schoolerp.html';
  });
</script>
<script>
  document.querySelector('[data-module="finance"]').addEventListener('click', () => {
    window.location.href = 'finance.html';
  });
</script>
</body>
</html>