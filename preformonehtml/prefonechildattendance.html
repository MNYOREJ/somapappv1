<!DOCTYPE html>
<html lang="en">
<head>
  <title>SoMAp â€” Preform One Per-Student Attendance</title>
  <!-- Same -->
  <script src="prefonecommon.js"></script>
  <style> body { background: linear-gradient(to right, #667eea, #764ba2); } </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-400 to-purple-600 text-white p-4">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">Preform One Per-Student Attendance</h1>
    <a href="prefoneattendance.html" class="bg-gray-500 p-2 rounded mb-4 inline-block">< Back</a>
    
    <input type="text" id="studentSearch" placeholder="Search Student" class="p-2 rounded w-full mb-4 bg-white/20 text-white" oninput="loadPerStudentAtt()">
    
    <div id="perStudentDetails"></div>
  </div>

  <script>
    function loadPerStudentAtt() {
      const query = document.getElementById('studentSearch').value.toLowerCase();
      db.ref(`/schools/Socrates School Preform one/${currentYear}/students`).orderByChild('firstName').startAt(query).once('value', snap => {
        const div = document.getElementById('perStudentDetails');
        div.innerHTML = Object.entries(snap.val() || {}).map(([adm, s]) => {
          const total = s.attendance.length;
          const pres = s.attendance.filter(a => a.present).length;
          const pct = (pres / total * 100).toFixed(1);
          const recentAbs = s.attendance.slice(-30).filter(a => !a.present).length;
          return `<div class="bg-white/10 p-4 rounded mb-2">
            <h3>${s.firstName} ${s.lastName} (${adm})</h3>
            <p>Present: ${pres}/${total} (${pct}%)</p>
            <p>Recent Absences (30 days): ${recentAbs}</p>
            <p>Reporting Date: ${s.reportingDate}</p>
          </div>`;
        }).join('');
      });
    }
    
    loadPerStudentAtt();
  </script>
</body>
</html>