<!DOCTYPE html>
<html lang="en">
<head>
  <title>SoMAp — Preform One Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="prefonecommon.js"></script>
  <style> body { background: linear-gradient(to right, #667eea, #764ba2); } </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-400 to-purple-600 text-white p-4">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-4xl font-bold mb-8 text-center"><i class="fas fa-graduation-cap"></i> Preform One Dashboard — Socrates School</h1>
    
    <!-- Year Selector -->
    <div class="mb-4 text-center">
      <select id="yearSelect" onchange="loadYear(this.value)" class="p-2 rounded bg-white text-black">
        <option>2024</option><option selected>2025</option><option>2026</option><!-- Up to 2030 -->
      </select>
    </div>
    
    <!-- Big Stats Cards -->
    <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-8">
      <div class="bg-white/20 p-4 rounded-lg text-center" id="totalRegistered">Total Registered: 0</div>
      <div class="bg-white/20 p-4 rounded-lg text-center" id="totalPresent">Total Present Today: 0</div>
      <div class="bg-white/20 p-4 rounded-lg text-center" id="totalAbsent">Total Absent: 0</div>
      <div class="bg-white/20 p-4 rounded-lg text-center" id="expectedMoney">Expected Till Now: 0 TSh</div>
      <div class="bg-white/20 p-4 rounded-lg text-center" id="collected">Collected: 0 TSh</div>
      <div class="bg-white/20 p-4 rounded-lg text-center" id="balance">Balance: 0 TSh</div>
      <div class="bg-white/20 p-4 rounded-lg text-center" id="expenses">Expenses: 0 TSh</div>
      <div class="bg-white/20 p-4 rounded-lg text-center" id="shifted">Shifted Kids: 0</div>
    </div>
    
    <!-- Navigation Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
      <a href="prefoneadmission.html" class="bg-blue-500 hover:bg-blue-600 p-4 rounded-lg text-center"><i class="fas fa-user-plus text-2xl mb-2"></i><br>Admissions</a>
      <a href="prefoneacademic.html" class="bg-green-500 hover:bg-green-600 p-4 rounded-lg text-center"><i class="fas fa-book text-2xl mb-2"></i><br>Academic</a>
      <a href="prefonescoresheet.html" class="bg-yellow-500 hover:bg-yellow-600 p-4 rounded-lg text-center"><i class="fas fa-chart-line text-2xl mb-2"></i><br>Scoresheet</a>
      <a href="prefoneattendance.html" class="bg-red-500 hover:bg-red-600 p-4 rounded-lg text-center"><i class="fas fa-calendar-check text-2xl mb-2"></i><br>Attendance</a>
      <a href="prefonefinance.html" class="bg-purple-500 hover:bg-purple-600 p-4 rounded-lg text-center"><i class="fas fa-money-bill text-2xl mb-2"></i><br>Finance</a>
      <a href="preoneexpenses.html" class="bg-orange-500 hover:bg-orange-600 p-4 rounded-lg text-center"><i class="fas fa-receipt text-2xl mb-2"></i><br>Expenses</a>
      <a href="prefonelessonplan.html" class="bg-indigo-500 hover:bg-indigo-600 p-4 rounded-lg text-center"><i class="fas fa-clipboard-list text-2xl mb-2"></i><br>Lesson Plan</a>
      <a href="prefoneteachersnames.html" class="bg-amber-500 hover:bg-amber-600 p-4 rounded-lg text-center"><i class="fas fa-users-gear text-2xl mb-2"></i><br>Teachers</a>
      <a href="prefoneclassjournal.html" class="bg-teal-500 hover:bg-teal-600 p-4 rounded-lg text-center"><i class="fas fa-journal-whills text-2xl mb-2"></i><br>Class Journal</a>
      <a href="prefonebooks.html" class="bg-pink-500 hover:bg-pink-600 p-4 rounded-lg text-center"><i class="fas fa-book-open text-2xl mb-2"></i><br>Books</a>
      <a href="prefonereportform.html" class="bg-cyan-500 hover:bg-cyan-600 p-4 rounded-lg text-center"><i class="fas fa-file-alt text-2xl mb-2"></i><br>Report Forms</a>
      <a href="prefoneshiftedkid.html" class="bg-gray-500 hover:bg-gray-600 p-4 rounded-lg text-center"><i class="fas fa-exchange-alt text-2xl mb-2"></i><br>Shifted Kids</a>
      <a href="prefonegenerateid.html" class="bg-lime-500 hover:bg-lime-600 p-4 rounded-lg text-center"><i class="fas fa-id-card text-2xl mb-2"></i><br>Generate ID</a>
    </div>
  </div>

  <script>
    // Load Data
    db.ref(`/schools/Socrates School Preform one/${currentYear}/students`).once('value', snap => {
      const students = snap.val() || {};
      const totalReg = Object.keys(students).length;
      document.getElementById('totalRegistered').innerHTML = `Total Registered: ${totalReg}`;
      
      // Present/Absent (today)
      const today = new Date().toISOString().split('T')[0];
      let present = 0, absent = 0;
      Object.values(students).forEach(s => {
        const att = s.attendance?.find(a => a.date === today);
        if (att?.present) present++; else absent++;
      });
      document.getElementById('totalPresent').innerHTML = `Total Present Today: ${present}`;
      document.getElementById('totalAbsent').innerHTML = `Total Absent: ${absent}`;
      
      // Finance Stats
      let expected = 0, collected = 0, expenses = 0, shifted = 0;
      Object.values(students).forEach(s => {
        expected += s.totalFee;
        collected += s.payments?.reduce((sum, p) => sum + p.amount, 0) || 0;
        if (s.shifted) shifted++;
      });
      db.ref(`/schools/Socrates School Preform one/${currentYear}/expenses`).once('value', eSnap => {
        expenses = Object.values(eSnap.val() || {}).reduce((sum, ex) => sum + ex.amount, 0);
        document.getElementById('expectedMoney').innerHTML = `Expected Till Now: ${expected} TSh`;
        document.getElementById('collected').innerHTML = `Collected: ${collected} TSh`;
        document.getElementById('balance').innerHTML = `Balance: ${collected - expenses} TSh`;
        document.getElementById('expenses').innerHTML = `Expenses: ${expenses} TSh`;
        document.getElementById('shifted').innerHTML = `Shifted Kids: ${shifted}`;
      });
    });
  </script>
</body>
</html>
