<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SoMAp — Society Management App</title>
  <!-- Tailwind CDN for enhanced styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --blue: #0b69ff;
      --muted: #f5f7fa;
      --card: #ffffff;
      --muted-text: #6b7280;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, Arial, sans-serif;
      background: var(--muted);
      color: #0b2540;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: var(--blue);
      color: #fff;
      padding: 14px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header .title { font-weight: 700; }
    .wrap { max-width: 1200px; margin: 18px auto; padding: 12px; width: 95%; }
    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px 24px;
      box-shadow: 0 8px 30px rgba(13, 38, 76, 0.06);
      border: 1px solid rgba(11, 22, 50, 0.04);
      margin-bottom: 20px;
    }
    h2, h3 { margin-top: 0; margin-bottom: 12px; color: var(--blue); }
    h3 { font-weight: 600; }
    .small { font-size: 13px; color: var(--muted-text); margin-bottom: 12px; }
    .tiny { font-size: 12px; color: var(--muted-text); }
    .form-row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 14px; }
    label {
      flex-basis: 100%;
      font-weight: 600;
      margin-bottom: 6px;
      color: #0b2540;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="email"],
    select,
    textarea {
      padding: 10px;
      border: 1px solid #e6e9ef;
      border-radius: 8px;
      font-size: 14px;
      width: 100%;
      font-family: inherit;
    }
    input[type="file"] { font-size: 14px; }
    select {
      appearance: none;
      background: white url('data:image/svg+xml;utf8,<svg fill="%230b69ff" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 10px center;
      background-size: 16px;
      cursor: pointer;
    }
    textarea { resize: vertical; min-height: 80px; }
    button {
      background: var(--blue);
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }
    button:hover { background: #074bd9; }
    button:disabled {
      background: #a3bffa;
      cursor: not-allowed;
    }
    .section { border-top: 1px solid #e6e9ef; padding-top: 20px; margin-top: 20px; }
    .grid-two-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
    @media (max-width: 720px) {
      .grid-two-cols { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
    <div class="title text-xl font-bold">SoMAp — Society Management App</div>
    <div class="tiny">Realtime • Firebase Realtime DB & Storage</div>
  </header>

  <div class="wrap">
    <div class="card" id="studentRegistration">
      <h2 class="text-2xl font-semibold text-blue-600">Student Registration & Profile Management</h2>
      <p class="small">Complete the digital student profile form below. Data saved to <code>/students</code>.</p>
      <form id="registrationForm" enctype="multipart/form-data" novalidate class="space-y-4">
        <div class="section">
          <h3>Basic Information</h3>
          <div class="grid-two-cols">
            <div><label for="firstName">First Name *</label><input type="text" id="firstName" name="firstName" placeholder="First Name" required class="border p-2 rounded" /></div>
            <div><label for="middleName">Middle Name</label><input type="text" id="middleName" name="middleName" placeholder="Middle Name" class="border p-2 rounded" /></div>
            <div><label for="lastName">Last Name *</label><input type="text" id="lastName" name="lastName" placeholder="Last Name" required class="border p-2 rounded" /></div>
            <div>
              <label for="gender">Gender *</label>
              <select id="gender" name="gender" required class="border p-2 rounded">
                <option value="" disabled selected>Select gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div><label for="dob">Date of Birth *</label><input type="date" id="dob" name="dob" required class="border p-2 rounded" /></div>
            <div><label for="admissionNumber">Admission Number (Auto-generated)</label><input type="text" id="admissionNumber" name="admissionNumber" placeholder="Auto-generated on save" disabled class="border p-2 rounded" /></div>
            <div><label for="pupilId">Pupil’s ID</label><input type="text" id="pupilId" name="pupilId" placeholder="Pupil's ID" class="border p-2 rounded" /></div>
            <div><label for="birthCertNumber">Birth Certificate Number</label><input type="text" id="birthCertNumber" name="birthCertNumber" placeholder="Birth Certificate Number" class="border p-2 rounded" /></div>
            <div><label for="religion">Religion</label><input type="text" id="religion" name="religion" placeholder="Religion" class="border p-2 rounded" /></div>
            <div><label for="tribe">Tribe / Ethnicity</label><input type="text" id="tribe" name="tribe" placeholder="Tribe or Ethnicity" class="border p-2 rounded" /></div>
          </div>
        </div>
        <div class="section">
          <h3>School Information</h3>
          <div class="grid-two-cols">
            <div><label for="schoolName">School Name *</label><input type="text" id="schoolName" name="schoolName" placeholder="School Name" required class="border p-2 rounded" /></div>
            <div>
              <label for="classLevel">Class Level *</label>
              <select id="classLevel" name="classLevel" required class="border p-2 rounded">
                <option value="" disabled selected>Select class</option>
                <option value="Baby Class">Baby Class</option>
                <option value="Class 1">Class 1</option>
                <option value="Class 2">Class 2</option>
                <option value="Class 3">Class 3</option>
                <option value="Class 4">Class 4</option>
                <option value="Class 5">Class 5</option>
                <option value="Class 6">Class 6</option>
                <option value="Class 7">Class 7</option>
              </select>
            </div>
            <div><label for="stream">Stream</label><input type="text" id="stream" name="stream" placeholder="e.g., 4B" class="border p-2 rounded" /></div>
            <div><label for="academicYear">Current Academic Year *</label><input type="text" id="academicYear" name="academicYear" placeholder="e.g., 2024" required class="border p-2 rounded" /></div>
            <div><label for="academicTrack">Academic Track</label><input type="text" id="academicTrack" name="academicTrack" placeholder="e.g., NURSERY / PRIMARY" class="border p-2 rounded" /></div>
            <div>
              <label for="boardingStatus">Boarding or Day Scholar *</label>
              <select id="boardingStatus" name="boardingStatus" required class="border p-2 rounded">
                <option value="" disabled selected>Select status</option>
                <option value="Boarding">Boarding</option>
                <option value="Day Scholar">Day Scholar</option>
              </select>
            </div>
            <div style="grid-column: span 2;"><label for="shiftedFrom">Shifted From (for transfer-ins)</label><input type="text" id="shiftedFrom" name="shiftedFrom" placeholder="Previous school if transferred" class="border p-2 rounded" /></div>
          </div>
        </div>
        <div class="section">
          <h3>Parent / Guardian Details</h3>
          <div class="grid-two-cols">
            <div><label for="primaryParentName">Primary Parent Name *</label><input type="text" id="primaryParentName" name="primaryParentName" placeholder="Primary Parent or Guardian" required class="border p-2 rounded" /></div>
            <div><label for="primaryParentContact">Primary Parent Contact (Mobile, WhatsApp) *</label><input type="text" id="primaryParentContact" name="primaryParentContact" placeholder="+255 7xx xxx xxx" required class="border p-2 rounded" /></div>
            <div><label for="secondaryGuardian">Secondary Guardian (if any)</label><input type="text" id="secondaryGuardian" name="secondaryGuardian" placeholder="Secondary Guardian" class="border p-2 rounded" /></div>
            <div><label for="relationshipToStudent">Relationship to Student</label><input type="text" id="relationshipToStudent" name="relationshipToStudent" placeholder="e.g., Aunt, Uncle" class="border p-2 rounded" /></div>
            <div style="grid-column: span 2;"><label for="residentialAddress">Residential Address *</label><textarea id="residentialAddress" name="residentialAddress" placeholder="Residential Address" required class="border p-2 rounded"></textarea></div>
            <div style="grid-column: span 2;"><label for="employmentStatus">Employment Status (if needed for bursary qualification)</label><input type="text" id="employmentStatus" name="employmentStatus" placeholder="Employment Status" class="border p-2 rounded" /></div>
          </div>
        </div>
        <div class="section">
          <h3>Photos & Attachments</h3>
          <div class="grid-two-cols">
            <div><label for="passportPhoto">Passport Photo Upload *</label><input type="file" id="passportPhoto" name="passportPhoto" accept="image/*" required class="border p-2 rounded" /></div>
            <div><label for="birthCertUpload">Birth Certificate Upload *</label><input type="file" id="birthCertUpload" name="birthCertUpload" accept="image/*,application/pdf" required class="border p-2 rounded" /></div>
            <div><label for="reportCardUpload">Report Card (First Term, Ongoing) *</label><input type="file" id="reportCardUpload" name="reportCardUpload" accept="image/*,application/pdf" required class="border p-2 rounded" /></div>
            <div><label for="joiningLetterUpload">Joining or Transfer Letter (PDF/Image) *</label><input type="file" id="joiningLetterUpload" name="joiningLetterUpload" accept="image/*,application/pdf" required class="border p-2 rounded" /></div>
            <div><label for="medicalDocsUpload">Medical Documents (if applicable)</label><input type="file" id="medicalDocsUpload" name="medicalDocsUpload" accept="image/*,application/pdf" class="border p-2 rounded" /></div>
          </div>
        </div>
        <button type="submit" id="registerBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white" disabled>Register Student</button>
      </form>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-storage-compat.js"></script>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBhONntRE_aRsU0y1YcPZzWud3CBfwH_a8",
      authDomain: "somaptestt.firebaseapp.com",
      databaseURL: "https://somaptestt-default-rtdb.firebaseio.com",
      projectId: "somaptestt",
      storageBucket: "somaptestt.firebasestorage.app",
      messagingSenderId: "105526245138",
      appId: "1:105526245138:web:b8e7c0cb82a46e861965cb",
      measurementId: "G-4HKX7KN6Q3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('registrationForm');
      const registerBtn = document.getElementById('registerBtn');
      const requiredFields = [
        'firstName', 'lastName', 'gender', 'dob', 'schoolName', 'classLevel',
        'academicYear', 'boardingStatus', 'primaryParentName', 'primaryParentContact',
        'residentialAddress'
      ];
      const requiredFiles = ['passportPhoto', 'birthCertUpload', 'reportCardUpload', 'joiningLetterUpload'];

      function checkFormValidity() {
        const allFieldsValid = requiredFields.every(field => {
          const input = document.getElementById(field);
          return input.value.trim() !== '';
        });

        const allFilesValid = requiredFiles.every(file => {
          const input = document.getElementById(file);
          return input.files.length > 0;
        });

        registerBtn.disabled = !(allFieldsValid && allFilesValid);
      }

      // Add event listeners for real-time validation
      requiredFields.forEach(field => {
        const input = document.getElementById(field);
        input.addEventListener('input', checkFormValidity);
      });

      requiredFiles.forEach(file => {
        const input = document.getElementById(file);
        input.addEventListener('change', checkFormValidity);
      });

      // Form submission handler
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        registerBtn.disabled = true;

        const formData = new FormData(form);
        const studentData = {
          firstName: formData.get('firstName'),
          middleName: formData.get('middleName'),
          lastName: formData.get('lastName'),
          gender: formData.get('gender'),
          dob: formData.get('dob'),
          admissionNumber: `AUTO-${Date.now()}`,
          pupilId: formData.get('pupilId'),
          birthCertNumber: formData.get('birthCertNumber'),
          religion: formData.get('religion'),
          tribe: formData.get('tribe'),
          schoolName: formData.get('schoolName'),
          classLevel: formData.get('classLevel'),
          stream: formData.get('stream'),
          academicYear: formData.get('academicYear'),
          academicTrack: formData.get('academicTrack'),
          boardingStatus: formData.get('boardingStatus'),
          shiftedFrom: formData.get('shiftedFrom'),
          primaryParentName: formData.get('primaryParentName'),
          primaryParentContact: formData.get('primaryParentContact'),
          secondaryGuardian: formData.get('secondaryGuardian'),
          relationshipToStudent: formData.get('relationshipToStudent'),
          residentialAddress: formData.get('residentialAddress'),
          employmentStatus: formData.get('employmentStatus'),
          timestamp: firebase.database.ServerValue.TIMESTAMP
        };

        try {
          // Save to Firebase Realtime Database
          const dbRef = db.ref('students');
          const newStudentRef = dbRef.push();
          await newStudentRef.set(studentData);

          // Upload files to Firebase Storage
          const uploadPromises = requiredFiles.map(async fileId => {
            const fileInput = document.getElementById(fileId);
            if (fileInput.files.length > 0) {
              const file = fileInput.files[0];
              const storageRef = storage.ref(`students/${newStudentRef.key}/${fileId}/${file.name}`);
              await storageRef.put(file);
              const downloadURL = await storageRef.getDownloadURL();
              return { [fileId]: downloadURL };
            }
            return {};
          });

          const uploadResults = await Promise.all(uploadPromises);
          const uploadData = Object.assign({}, ...uploadResults);
          await newStudentRef.update(uploadData);

          alert('Student registered successfully!');
          form.reset();
          registerBtn.disabled = true; // Reset button state
        } catch (error) {
          alert('Error registering student: ' + error.message);
        } finally {
          registerBtn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>