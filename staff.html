<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SoMAp ‚Äî Staff Portal</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="../firebase.js"></script>
</head>
<body>
  <h2>Loading your dashboard...</h2>

  <script>
    const db = window.db;

    firebase.auth().onAuthStateChanged(async (user) => {
      if (!user) {
        alert("You must sign in first.");
        window.location.href = "login.html"; // adjust if you already have login
        return;
      }

      const emailKey = user.email.replace(/\./g, "_");
      try {
        const snap = await db.ref("users/" + emailKey).get();
        if (!snap.exists()) {
          alert("No class assigned to your account.");
          return;
        }

        const userData = snap.val();
        const userClass = userData.class || "";

        // üîê Lock class into sessionStorage
        sessionStorage.setItem("className", userClass);

        // Redirect into academic.html
        window.location.href = "academic.html";
      } catch (err) {
        console.error("Error loading user class:", err);
        alert("Error: cannot detect your class.");
      }
    });
  </script>
</body>
</html>
