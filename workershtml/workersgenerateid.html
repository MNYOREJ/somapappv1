<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SoMAp • Staff ID Card Studio</title>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
  <script src="../firebase.js"></script>

  <!-- UI + Export libs -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body{
      min-height:100vh;
      background:
        radial-gradient(1200px 700px at 15% -10%, rgba(16,185,129,0.18), transparent 40%),
        radial-gradient(1000px 700px at 85% -15%, rgba(234,179,8,0.18), transparent 45%),
        linear-gradient(180deg,#0b1220,#0b1a16 70%,#07100f);
      color:#0f172a;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .glass{ background:rgba(255,255,255,0.9); border:1px solid rgba(255,255,255,0.35); backdrop-filter:blur(16px); border-radius:18px; }
    /* CR80 card ratio ~ 85.6 x 54 mm. We'll render around 1011x638 px for sharp previews */
    .id-card{ width:1011px; height:638px; position:relative; border-radius:24px; overflow:hidden; }
    .foil { background: conic-gradient(from 210deg at 70% 0%, #FDE68A, #F59E0B, #FCD34D, #D97706, #FDE68A);
            filter: saturate(1.1) brightness(1.05); }
    .foil-line{ height:10px; border-radius:999px; }
    .gold { color:#B45309; }
    .watermark { position:absolute; inset:0; opacity:.06; background:url('../images/somap-logo.png.jpg') center/40% no-repeat; }
    .chip { width:70px; height:50px; border-radius:8px; background:linear-gradient(135deg,#e5e7eb,#9ca3af); box-shadow:inset 0 0 0 2px rgba(0,0,0,.08);}
    .seal { position:absolute; right:28px; bottom:28px; width:110px; height:110px; border-radius:999px; 
            background: radial-gradient(circle at 30% 30%, #fff, #FDE68A 35%, #B45309 70%, #7C2D12 100%);
            box-shadow: 0 8px 24px rgba(0,0,0,.25); border:3px solid rgba(124,45,18,.65);}
    .sparkles::after{
      content:""; position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(8px 8px at 10% 20%, rgba(255,255,255,.45), transparent 40%),
        radial-gradient(6px 6px at 80% 25%, rgba(255,255,255,.35), transparent 40%),
        radial-gradient(7px 7px at 30% 70%, rgba(255,255,255,.25), transparent 40%);
    }
    .avatar { width:200px; height:240px; border-radius:16px; object-fit:cover; border:6px solid rgba(255,255,255,.85); box-shadow:0 10px 24px rgba(0,0,0,.25); }
    .badge { border:1px solid rgba(16,185,129,.4); background:rgba(16,185,129,.12); color:#065f46; border-radius:999px; padding:.25rem .75rem; font-weight:600; font-size:.85rem;}
    .subtle { color:#475569; }
    /* print-safe preview scale for smaller screens */
    @media (max-width:1280px){ .id-card{ transform: scale(.6); transform-origin: top left; } }
  </style>
</head>
<body>
  <main id="app" class="p-6 max-w-7xl mx-auto space-y-6">
    <header class="glass p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <p class="uppercase tracking-[.35em] text-xs text-slate-500">HR • Security</p>
        <h1 class="text-2xl md:text-3xl font-extrabold text-slate-900">Staff ID Card Studio</h1>
        <p class="text-slate-600 text-sm">Preview front & back. Export one PDF with both sides. Optimised for low bandwidth.</p>
      </div>
      <div class="flex gap-2">
        <input id="searchBox" placeholder="Search name or Staff ID…" class="px-3 py-2 rounded border text-sm w-64"/>
        <button id="downloadPdf" class="px-4 py-2 rounded bg-emerald-600 text-white font-semibold shadow">Download PDF</button>
      </div>
    </header>

    <section class="glass p-5">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-5">
        <!-- Results -->
        <div class="lg:col-span-1 space-y-3">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">Staff</h2>
            <span id="countHint" class="text-xs text-slate-500">0</span>
          </div>
          <div id="results" class="max-h-[60vh] overflow-auto divide-y"></div>
        </div>

        <!-- Previews -->
        <div class="lg:col-span-2 space-y-6">
          <div class="text-sm text-slate-500">Live Preview</div>
          <div id="front" class="id-card sparkles glass relative overflow-hidden">
            <div class="watermark"></div>
            <!-- Emerald/Gold banner -->
            <div class="absolute -top-24 -left-16 rotate-[8deg] w-[120%] h-56 rounded-3xl shadow-xl"
                 style="background:linear-gradient(135deg,#064e3b,#052e2b 45%,#0f766e 70%); border:2px solid rgba(255,255,255,.35)"></div>
            <div class="absolute top-6 left-8 flex items-center gap-3 z-10">
              <img src="../images/somap-logo.png.jpg" alt="Logo" class="w-14 h-14 rounded-lg border border-white/60 bg-white/80 object-cover"/>
              <div>
                <div class="text-white/90 font-extrabold tracking-wide">SOCRATES SCHOOL</div>
                <div class="text-[11px] text-white/70">P.O. Box 14256, Arusha • 0686828732 / 0689649822</div>
              </div>
            </div>

            <!-- Photo -->
            <img id="wPhoto" crossOrigin="anonymous" referrerpolicy="no-referrer"
                 class="avatar absolute top-20 right-8 z-10" src="" alt="Passport"/>

            <!-- Name & role -->
            <div class="absolute left-10 top-40 z-10">
              <div class="text-3xl font-black tracking-wide" id="wName">—</div>
              <div class="mt-1 badge" id="wRole">Role • Department</div>
              <div class="mt-3 text-sm subtle" id="wId">Staff ID: —</div>
            </div>

            <!-- Foil accent line -->
            <div class="foil foil-line absolute left-8 right-8 bottom-72 rounded-full opacity-80"></div>

            <!-- QR + meta -->
            <div class="absolute left-10 bottom-10 flex items-center gap-6">
              <div id="qrFront" class="bg-white p-2 rounded-lg border"></div>
              <div class="text-xs subtle leading-relaxed">
                <div><span class="gold font-semibold">Valid</span>: <span id="wValid">2025–2026</span></div>
                <div>Phone: <span id="wPhone">—</span></div>
                <div>Address: P.O. Box 14256, Arusha, Tanzania</div>
              </div>
            </div>

            <!-- Seal -->
            <div class="seal"></div>
          </div>

          <div id="back" class="id-card glass relative overflow-hidden">
            <div class="watermark"></div>
            <div class="absolute inset-0" style="background:linear-gradient(180deg,rgba(253,230,138,.25),rgba(255,255,255,.65));"></div>

            <div class="absolute top-6 left-8 right-8 flex items-center justify-between">
              <div class="chip"></div>
              <div class="text-sm font-semibold gold">Employee Identity Card</div>
              <div class="chip"></div>
            </div>

            <div class="absolute left-10 right-10 top-28 grid grid-cols-2 gap-6 text-[15px]">
              <div class="space-y-2">
                <div><span class="font-semibold">Name:</span> <span id="bName">—</span></div>
                <div><span class="font-semibold">Role:</span> <span id="bRole">—</span></div>
                <div><span class="font-semibold">Department:</span> <span id="bDept">—</span></div>
                <div><span class="font-semibold">Staff ID:</span> <span id="bStaffId">—</span></div>
              </div>
              <div class="space-y-2">
                <div><span class="font-semibold">Phone:</span> <span id="bPhone">—</span></div>
                <div><span class="font-semibold">Blood Group:</span> <span id="bBlood">—</span></div>
                <div><span class="font-semibold">Emergency:</span> <span id="bEmerg">—</span></div>
                <div><span class="font-semibold">Issued:</span> <span id="bIssued">—</span></div>
              </div>
            </div>

            <div class="absolute left-10 right-10 bottom-28 text-xs text-slate-600 leading-relaxed">
              This card is property of Socrates School. If found, please return to the address above. Misuse is subject to
              disciplinary action. For verification, scan the QR code or visit somapv2i.com/verify.
            </div>

            <div class="absolute left-10 bottom-10">
              <div id="qrBack" class="bg-white p-2 rounded-lg border"></div>
            </div>

            <div class="absolute right-10 bottom-10 text-center">
              <div class="w-40 h-[2px] bg-slate-700/60 mb-1"></div>
              <div class="text-xs">Authorised Signature</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="./modules/workers_idcards.js"></script>
</body>
</html>
